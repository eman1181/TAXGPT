<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Cairo", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      direction: rtl;
    }
    .container {
      max-width: 700px;
      margin: 0 auto;
      background: white;
      border-radius: 25px;
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
    }
    .header {
      background: linear-gradient(135deg, #003366 0%, #0055aa 100%);
      color: white;
      padding: 40px 30px;
      text-align: center;
      position: relative;
    }
    .header::after {
      content: '';
      position: absolute;
      bottom: -20px;
      left: 0;
      right: 0;
      height: 40px;
      background: white;
      border-radius: 50% 50% 0 0;
    }
    .header h1 {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    .header p {
      opacity: 0.9;
      font-size: 1rem;
    }
    .form-content {
      padding: 40px 30px;
    }
    .service-info {
      background: linear-gradient(135deg, #e0f7fa 0%, #b2ebf2 100%);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      border-right: 4px solid #00acc1;
    }
    .service-info h3 {
      color: #006064;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    .service-info p {
      color: #00838f;
      margin: 5px 0;
      font-size: 0.95rem;
    }
    .form-group {
      margin-bottom: 25px;
    }
    label {
      display: block;
      color: #003366;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    label .required {
      color: #e53e3e;
    }
    input, select, textarea {
      width: 100%;
      padding: 14px 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-family: "Cairo", sans-serif;
      font-size: 0.95rem;
      transition: all 0.3s;
      background: white;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
    }
    textarea {
      resize: vertical;
      min-height: 120px;
      line-height: 1.6;
    }
    .file-upload {
      border: 2px dashed #cbd5e0;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #f7fafc;
    }
    .file-upload:hover {
      border-color: #667eea;
      background: #eef2ff;
    }
    .file-upload input {
      display: none;
    }
    .file-upload-icon {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #667eea;
    }
    .file-list {
      margin-top: 15px;
    }
    .file-item {
      background: #f0f4f8;
      padding: 12px 16px;
      border-radius: 10px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .file-item button {
      background: #e53e3e;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.85rem;
    }
    .submit-btn {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 18px 40px;
      border-radius: 12px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      width: 100%;
      transition: all 0.3s;
      margin-top: 20px;
    }
    .submit-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
    }
    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    .success-message {
      display: none;
      background: #d4edda;
      border: 2px solid #28a745;
      color: #155724;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      margin-top: 20px;
    }
    .success-message.active {
      display: block;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    @media (max-width: 768px) {
      .grid-2 {
        grid-template-columns: 1fr;
      }
      .header h1 {
        font-size: 1.5rem;
      }
      .form-content {
        padding: 30px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <img src="./logo.JPEG" alt="Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…ØµØ±ÙŠØ©" style="height: 30px; margin-top: 10px;" />
      <h1> Ø§Ø³ØªÙ…Ø§Ø±Ø© Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</h1>
      <p>Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¯Ù‚Ø© ÙˆØ³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª</p>
    </div>

    <div class="form-content">
      <div class="service-info" id="serviceInfo">
        <h3>ğŸ“Œ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø®Ø¯Ù…Ø©</h3>
        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> <span id="serviceName">-</span></p>
        <p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©:</strong> <span id="taxType">-</span></p>
        <p><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø¬Ø¹ÙŠ:</strong> <span id="refNumber">-</span></p>
      </div>

      <form id="taxForm">
        <div class="grid-2">
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ <span class="required">*</span></label>
            <input type="text" id="regNumber" placeholder="123456789" required />
          </div>

          <div class="form-group">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ <span class="required">*</span></label>
            <input type="text" id="fullName" placeholder="Ø£Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø¹Ù„ÙŠ" required />
          </div>
        </div>

        <div class="grid-2">
          <div class="form-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ <span class="required">*</span></label>
            <input type="tel" id="mobile" placeholder="01XXXXXXXXX" required />
          </div>

          <div class="form-group">
            <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="required">*</span></label>
            <input type="email" id="email" placeholder="example@email.com" required />
          </div>
        </div>

        <div class="form-group">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© <span class="required">*</span></label>
          <select id="taxCategory" required>
            <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© --</option>
            <option value="vat">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© (VAT)</option>
            <option value="income">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ø®Ù„</option>
            <option value="corporate">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª</option>
            <option value="stamp">Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ©</option>
            <option value="withholding">Ø§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ©</option>
            <option value="customs">Ø§Ù„Ø¬Ù…Ø§Ø±Ùƒ</option>
            <option value="other">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>

        <div class="form-group">
          <label>ØªØµÙ†ÙŠÙ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± <span class="required">*</span></label>
          <select id="inquiryType" required>
            <option value="">-- Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ --</option>
            <option value="registration">Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠ</option>
            <option value="returns">Ø§Ù„Ø¥Ù‚Ø±Ø§Ø±Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©</option>
            <option value="refund">Ø±Ø¯ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</option>
            <option value="exemption">Ø§Ù„Ø¥Ø¹ÙØ§Ø¡Ø§Øª</option>
            <option value="penalties">Ø§Ù„ØºØ±Ø§Ù…Ø§Øª ÙˆØ§Ù„Ø¬Ø²Ø§Ø¡Ø§Øª</option>
            <option value="calculation">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©</option>
            <option value="objection">Ø§Ù„Ø§Ø¹ØªØ±Ø§Ø¶ Ø¹Ù„Ù‰ Ø±Ø¨Ø·</option>
            <option value="other">Ø£Ø®Ø±Ù‰</option>
          </select>
        </div>

        <div class="form-group">
          <label>Ù†Øµ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± <span class="required">*</span></label>
          <textarea id="inquiryText" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³ØªÙØ³Ø§Ø±Ùƒ Ø¨Ø§Ù„ØªÙØµÙŠÙ„..." required></textarea>
        </div>

        <div class="form-group">
          <label>Ù…Ø±ÙÙ‚ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± (PDF, Word, ØµÙˆØ±Ø©)</label>
          <div class="file-upload" onclick="document.getElementById('mainFile').click()">
            <div class="file-upload-icon">ğŸ“„</div>
            <p><strong>Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</strong></p>
            <p style="font-size: 0.85rem; color: #718096; margin-top: 5px;">Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø£Ù‚ØµÙ‰: 10 Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª</p>
            <input type="file" id="mainFile" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="handleMainFile(event)" />
          </div>
          <div id="mainFilePreview" class="file-list"></div>
        </div>

        <div class="form-group">
          <label>Ù…Ø±ÙÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <div class="file-upload" onclick="document.getElementById('additionalFiles').click()">
            <div class="file-upload-icon">ğŸ“</div>
            <p><strong>Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©</strong></p>
            <p style="font-size: 0.85rem; color: #718096; margin-top: 5px;">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ø¹Ø¯Ø© Ù…Ù„ÙØ§Øª</p>
            <input type="file" id="additionalFiles" multiple accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="handleAdditionalFiles(event)" />
          </div>
          <div id="additionalFilesPreview" class="file-list"></div>
        </div>

        <button type="submit" class="submit-btn" id="submitBtn">
          ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±
        </button>

        <div class="success-message" id="successMessage">
          <h3 style="color: #28a745; margin-bottom: 10px;">âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­!</h3>
          <p>Ø±Ù‚Ù… Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©: <strong id="trackingNumber"></strong></p>
          <p style="margin-top: 10px;">Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ø®Ù„Ø§Ù„ 24-48 Ø³Ø§Ø¹Ø©</p>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù€ URL
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.has('service')) {
      document.getElementById('serviceName').textContent = urlParams.get('service');
      document.getElementById('taxType').textContent = getTaxName(urlParams.get('tax'));
      document.getElementById('refNumber').textContent = urlParams.get('ref');
      
      // Ù…Ù„Ø¡ Ù†ÙˆØ¹ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      document.getElementById('taxCategory').value = urlParams.get('tax');
    }

    function getTaxName(code) {
      const names = {
        'vat': 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©',
        'income': 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ø®Ù„',
        'corporate': 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø´Ø±ÙƒØ§Øª',
        'stamp': 'Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ø¯Ù…ØºØ©',
        'withholding': 'Ø§Ù„Ø®ØµÙ… ÙˆØ§Ù„Ø¥Ø¶Ø§ÙØ©',
        'customs': 'Ø§Ù„Ø¬Ù…Ø§Ø±Ùƒ',
        'other': 'Ø£Ø®Ø±Ù‰'
      };
      return names[code] || code;
    }

    let mainFile = null;
    let additionalFiles = [];

    function handleMainFile(event) {
      const file = event.target.files[0];
      if (file) {
        mainFile = file;
        displayMainFile(file);
      }
    }

    function displayMainFile(file) {
      const preview = document.getElementById('mainFilePreview');
      preview.innerHTML = `
        <div class="file-item">
          <span>ğŸ“„ ${file.name} (${formatFileSize(file.size)})</span>
          <button type="button" onclick="removeMainFile()">Ø­Ø°Ù</button>
        </div>
      `;
    }

    function removeMainFile() {
      mainFile = null;
      document.getElementById('mainFile').value = '';
      document.getElementById('mainFilePreview').innerHTML = '';
    }

    function handleAdditionalFiles(event) {
      const files = Array.from(event.target.files);
      additionalFiles = [...additionalFiles, ...files];
      displayAdditionalFiles();
    }

    function displayAdditionalFiles() {
      const preview = document.getElementById('additionalFilesPreview');
      preview.innerHTML = additionalFiles.map((file, index) => `
        <div class="file-item">
          <span>ğŸ“ ${file.name} (${formatFileSize(file.size)})</span>
          <button type="button" onclick="removeAdditionalFile(${index})">Ø­Ø°Ù</button>
        </div>
      `).join('');
    }

    function removeAdditionalFile(index) {
      additionalFiles.splice(index, 1);
      displayAdditionalFiles();
    }

    function formatFileSize(bytes) {
      if (bytes < 1024) return bytes + ' B';
      if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
      return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
    }

    document.getElementById('taxForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...';

      // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const formData = new FormData();
      formData.append('regNumber', document.getElementById('regNumber').value);
      formData.append('fullName', document.getElementById('fullName').value);
      formData.append('mobile', document.getElementById('mobile').value);
      formData.append('email', document.getElementById('email').value);
      formData.append('taxCategory', document.getElementById('taxCategory').value);
      formData.append('inquiryType', document.getElementById('inquiryType').value);
      formData.append('inquiryText', document.getElementById('inquiryText').value);
      formData.append('refNumber', urlParams.get('ref') || 'N/A');

      if (mainFile) formData.append('mainFile', mainFile);
      additionalFiles.forEach((file, i) => formData.append(`additionalFile${i}`, file));

      try {
        // Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ù€ Backend
        const response = await fetch('http://127.0.0.1:5000/submit-inquiry', {
          method: 'POST',
          body: formData
        });

        const result = await response.json();

        if (response.ok) {
          // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
          document.getElementById('trackingNumber').textContent = result.trackingNumber;
          document.getElementById('successMessage').classList.add('active');
          document.getElementById('taxForm').style.display = 'none';
        } else {
          alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: ' + result.message);
        }
      } catch (error) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±';
      }
    });
  </script>
</body>
</html>