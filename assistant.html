<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="logo.jpeg" />
  <title>TaxGPT â€” Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨</title>
  <link rel="icon" href="https://eta.gov.eg/sites/default/files/favicon.ico" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: "Cairo", sans-serif;
      background: #f9fbff;
      color: #003366;
    }
    .navbar {
      background-color: #003366;
    }
    .navbar-brand img {
      height: 55px;
    }
    .navbar-nav .nav-link {
      color: #fff !important;
      font-weight: 500;
    }
    .navbar-nav .nav-link:hover {
      color: #ffcc00 !important;
    }
    .assistant-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 80vh;
      padding: 40px 0;
    }
    .card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 700px;
      padding: 2rem;
      text-align: center;
    }
    input, textarea, button {
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-family: "Cairo", sans-serif;
    }
    input, textarea {
      background: rgba(0,0,0,0.05);
    }
    button {
      background: #ffcc00;
      color: #003366;
      font-weight: bold;
      cursor: pointer;
    }
    .chat-box {
      background: rgba(0,0,0,0.05);
      border-radius: 10px;
      padding: 10px;
      text-align: right;
      height: 260px;
      overflow-y: auto;
      margin-bottom: 10px;
    }
    .message {
      margin: 5px 0;
      padding: 8px 12px;
      border-radius: 8px;
      max-width: 90%;
      line-height: 1.4;
      text-align: right;
    }
    .user {
      background: #ffcc00;
      color: #003366;
      margin-left: auto;
    }
    .bot {
      background: rgba(0,0,0,0.1);
      color: #003366;
      margin-right: auto;
    }
    footer {
      background: #002244;
      color: #d1d5db;
      padding: 20px 0;
      text-align: center;
    }
    .btn-row {
      display: flex;
      gap: 10px;
      width: 100%;
    }
    .btn-row button {
      width: 50%;
    }
    #statusText {
      font-size: 0.8rem;
      color: #6b7280;
      text-align: right;
      margin-top: 4px;
      min-height: 1em;
    }
    .star {
  opacity: 0.3;
  transition: transform 0.1s ease, opacity 0.1s ease;
}
.star.selected {
  opacity: 1;
}
.star:hover {
  transform: scale(1.1);
}

  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg">
    <div class="container">
      <a class="navbar-brand" href="index.html">
        <img src="logo.jpeg" alt="Ø´Ø¹Ø§Ø± Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…ØµØ±ÙŠØ©" />
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a href="index.html" class="nav-link">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Ù…Ø±ÙƒØ² Ø¥Ø¹Ù„Ø§Ù…ÙŠ</a></li>
          <li class="nav-item"><a href="#" class="nav-link">Ø§Ù„ØªØ³Ù‡ÙŠÙ„Ø§Øª Ø§Ù„Ø¶Ø±ÙŠØ¨ÙŠØ©</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <section class="assistant-container">
    <!-- ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginPage" class="card">
      <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h3>
      <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
      <input type="password" id="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
      <button id="loginBtn">Ø¯Ø®ÙˆÙ„</button>
    </div>

    <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© + Ø§Ù„Ø®Ø·Ø§Ø¨ -->
    <div id="chatPage" class="card" style="display:none;">
      <h3>TaxGPT</h3>
      <div id="chatBox" class="chat-box"></div>

      <textarea id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." rows="2"></textarea>
      <input type="file" id="fileInput" accept=".pdf,.docx,.txt" style="display:none;" />

      <div class="btn-row">
        <button id="sendBtn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
        <button id="uploadBtn">ğŸ“ Ø±ÙØ¹ Ù…Ù„Ù</button>
      </div>

      <hr />

      <!-- âœ… Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø®Ø·Ø§Ø¨ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ + ØªØ­Ù…ÙŠÙ„ Word -->
      <label for="letterArea" class="w-100 text-end fw-bold mb-0">
        Ù†Øµ Ø§Ù„Ø®Ø·Ø§Ø¨ Ø§Ù„Ù†Ø§ØªØ¬ (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„):
      </label>
      <textarea id="letterArea" rows="8" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù†Øµ Ø§Ù„Ø®Ø·Ø§Ø¨ Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø¨Ø¹Ø¯ ØªÙˆÙ„ÙŠØ¯Ù‡..."></textarea>
      <button id="downloadLetterBtn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·Ø§Ø¨ ÙƒÙ…Ù„Ù Word</button>
      <div id="statusText"></div>

         <!-- â¬‡â¬‡â¬‡ Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¨Ø§Ù„Ù†Ø¬ÙˆÙ… â¬‡â¬‡â¬‡ -->
         <div id="feedbackSection" style="display:none; text-align:right; margin-top:10px;">
          <label for="ratingStars" class="w-100 fw-bold mb-1">
            ÙƒÙŠÙ ØªÙ‚ÙŠÙ… Ø¯Ù‚Ø© Ù‡Ø°Ø§ Ø§Ù„Ø±Ø¯ØŸ
          </label>
  
          <div id="ratingStars" style="direction:ltr; font-size:24px; cursor:pointer;">
            <span class="star" data-value="1">&#9733;</span>
            <span class="star" data-value="2">&#9733;</span>
            <span class="star" data-value="3">&#9733;</span>
            <span class="star" data-value="4">&#9733;</span>
            <span class="star" data-value="5">&#9733;</span>
          </div>
  
          <input type="hidden" id="ratingValue" value="0" />
  
          <small style="display:block; margin-top:5px;">
            1 = Ø³ÙŠØ¦ Ø¬Ø¯Ù‹Ø§ &nbsp;&nbsp; 5 = Ù…Ù…ØªØ§Ø²
          </small>
  
          <button id="sendFeedbackBtn" style="width:auto; margin-top:8px;">
            Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
          </button>
  
          <span id="feedbackStatus" style="display:block; font-size:0.8rem; color:#6b7280; margin-top:4px;"></span>
        </div>
  

    </div>
  </section>

  <footer>
    <div class="container">
      <p>Â© 2025 Ù…ØµÙ„Ø­Ø© Ø§Ù„Ø¶Ø±Ø§Ø¦Ø¨ Ø§Ù„Ù…ØµØ±ÙŠØ© â€” Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©</p>
    </div>
  </footer>

  <script>
    // ğŸ”— Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù€ API Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ FastAPI
    const API_BASE = "http://localhost:8000";

    const loginPage = document.getElementById("loginPage");
    const chatPage = document.getElementById("chatPage");
    const loginBtn = document.getElementById("loginBtn");
    const chatBox = document.getElementById("chatBox");
    const userInput = document.getElementById("userInput");
    const sendBtn = document.getElementById("sendBtn");
    const fileInput = document.getElementById("fileInput");
    const uploadBtn = document.getElementById("uploadBtn");

    const letterArea = document.getElementById("letterArea");
    const downloadLetterBtn = document.getElementById("downloadLetterBtn");
    const statusText = document.getElementById("statusText");

    const feedbackSection = document.getElementById("feedbackSection");
    const feedbackStatus = document.getElementById("feedbackStatus");
    const stars = document.querySelectorAll("#ratingStars .star");
    const ratingInput = document.getElementById("ratingValue");
    const sendFeedbackBtn = document.getElementById("sendFeedbackBtn");


    let lastQuestion = null;
    let lastAnswer = null;


    // ----------------- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¨Ø³ÙŠØ· -----------------
    loginBtn.onclick = () => {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if (
        (email === "admin@example.com" && password === "1234") ||
        (email === "user@eta.gov.eg" && password === "5678")
      ) {
        loginPage.style.display = "none";
        chatPage.style.display = "block";
        addMessage(`Ù…Ø±Ø­Ø¨Ù‹Ø§ ${email.split("@")[0]} ğŸ‘‹! ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ø§Ù„ÙŠÙˆÙ…ØŸ`, "bot");
      } else {
        alert("âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
      }
    };

    // ----------------- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø¤Ø§Ù„ -----------------
    sendBtn.onclick = sendMessage;
    userInput.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });

    async function sendMessage() {
      const text = userInput.value.trim();
      if (!text) return;

      // Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙŠ Ø§Ù„Ø´Ø§Øª
      addMessage(text, "user");
      userInput.value = "";

      // Ø£Ø¶Ù Ø±Ø³Ø§Ù„Ø© ØªÙÙŠØ¯ Ø£Ù† Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø§Ø¨
      addMessage("â³ Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ø¨ Ø¶Ø±ÙŠØ¨ÙŠ Ù‚Ø§Ù†ÙˆÙ†ÙŠ Ù…ÙØµÙ„ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„Ùƒ...", "bot");
      statusText.textContent = "Ø¬Ø§Ø±ÙŠ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø§Ø¨ Ù…Ù† Ø§Ù„Ø®Ø§Ø¯Ù…...";

      try {
        const res = await fetch(`${API_BASE}/tax-answer`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ question: text, top_k: 5 }),
        });

        if (!res.ok) {
          let errText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø®Ø·Ø§Ø¨.";
          try {
            const errData = await res.json();
            if (errData.detail) errText = errData.detail;
          } catch (_) {}
          addMessage("âŒ " + errText, "bot");
          statusText.textContent = errText;
          return;
        }

        const data = await res.json();
        const answer = data.answer || "";

        // Ø¶Ø¹ Ù†Øµ Ø§Ù„Ø®Ø·Ø§Ø¨ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
        letterArea.value = answer;

        addMessage("âœ… ØªÙ… Ø¥Ø¹Ø¯Ø§Ø¯ Ø®Ø·Ø§Ø¨ Ø¶Ø±ÙŠØ¨ÙŠ ØªÙØµÙŠÙ„ÙŠ. ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø±Ø§Ø¬Ø¹ØªÙ‡ ÙˆØªØ¹Ø¯ÙŠÙ„Ù‡ ÙÙŠ Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø£Ø³ÙÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©.", "bot");
        statusText.textContent = "ØªÙ… Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­. Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ù†Øµ ÙƒÙ…Ø§ ØªØ´Ø§Ø¡ Ø«Ù… Ø§Ø¶ØºØ· ØªØ­Ù…ÙŠÙ„ ÙƒÙ…Ù„Ù Word.";
        // ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± Ø³Ø¤Ø§Ù„ ÙˆØ¢Ø®Ø± Ø¬ÙˆØ§Ø¨ Ø¹Ø´Ø§Ù† Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        lastQuestion = text;
        lastAnswer = answer;

        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…
        feedbackSection.style.display = "block";
        feedbackStatus.textContent = "";

      } catch (e) {
        console.error(e);
        addMessage("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….", "bot");
        statusText.textContent = "ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù….";
      }
    }
        // ----------------- Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ… Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ -----------------
        async function sendFeedback(rating) {
      if (!lastQuestion || !lastAnswer) {
        alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ø¯ Ù„ØªÙ‚ÙŠÙŠÙ…Ù‡ Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.");
        return;
      }

      // Ø§Ù„Ù†Øµ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù…Ù† Ø§Ù„Ù€ textarea
      const edited = letterArea.value.trim();

      feedbackStatus.textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ…...";
      try {
        const res = await fetch(`${API_BASE}/feedback`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            question: lastQuestion,
            original_answer: lastAnswer,   // Ø±Ø¯ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø£ØµÙ„ÙŠ
            edited_answer: edited || null, // Ø§Ù„Ù„ÙŠ Ø§Ù„ÙŠÙˆØ²Ø± ÙƒØªØ¨Ù‡ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„
            rating: rating,                // Ø±Ù‚Ù… Ù…Ù† 1 Ù„Ù€ 5
            comment: null
          }),
        });

        if (!res.ok) {
          feedbackStatus.textContent = "Ù„Ù… ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚ÙŠÙŠÙ….";
          return;
        }

        feedbackStatus.textContent = "âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ ØªÙ‚ÙŠÙŠÙ…Ùƒ. Ø´ÙƒØ±Ù‹Ø§ Ù„ÙƒÙ.";
      } catch (err) {
        console.error(err);
        feedbackStatus.textContent = "ØªØ¹Ø°Ø± Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ‚ÙŠÙŠÙ….";
      }
    }

    // -------- Ù…Ù†Ø·Ù‚ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†Ø¬ÙˆÙ… + Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø¯Ø§Ù„Ø© sendFeedback --------
    function updateStars(selectedValue) {
      stars.forEach(star => {
        const value = parseInt(star.getAttribute("data-value"));
        if (value <= selectedValue) {
          star.classList.add("selected");
        } else {
          star.classList.remove("selected");
        }
      });
    }

    stars.forEach(star => {
      star.addEventListener("click", function () {
        const value = parseInt(this.getAttribute("data-value"));
        ratingInput.value = value;
        updateStars(value);
      });
    });

    sendFeedbackBtn.addEventListener("click", function () {
      const rating = parseInt(ratingInput.value || "0", 10);
      if (!rating || rating < 1) {
        feedbackStatus.textContent = "Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± Ø¹Ø¯Ø¯ Ø§Ù„Ù†Ø¬ÙˆÙ… Ø£ÙˆÙ„Ø§Ù‹.";
        return;
      }
      sendFeedback(rating);
    });


    
   // ----------------- ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø·Ø§Ø¨ ÙƒÙ…Ù„Ù Word -----------------
downloadLetterBtn.onclick = async () => {
  const text = letterArea.value.trim();
  if (!text) {
    alert("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†Øµ Ø®Ø·Ø§Ø¨ Ù„ØªØ­Ù…ÙŠÙ„Ù‡. Ù…Ù† ÙØ¶Ù„Ùƒ Ù‚Ù… Ø¨Ø§Ù„ØªÙˆÙ„ÙŠØ¯ Ø£Ùˆ Ø§ÙƒØªØ¨ Ù†ØµÙ‹Ø§.");
    return;
  }

  statusText.textContent = "â³ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù Word...";
  downloadLetterBtn.disabled = true;

  try {
    const res = await fetch(`${API_BASE}/export-docx`, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        content: text, // ğŸ‘ˆ Ø¯Ù‡ Ø§Ù„Ù„ÙŠ Ø§Ù„Ø¨Ø§Ùƒ Ø¥Ù†Ø¯ Ù…Ø³ØªÙ†ÙŠÙ‡
      }),
    });

    if (!res.ok) {
      let errText = "ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù Word.";
      try {
        const errData = await res.json();
        if (errData.detail) errText = errData.detail;
      } catch (_) {}
      statusText.textContent = errText;
      alert(errText);
      return;
    }

    const blob = await res.blob();
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "tax_letter.docx";
    document.body.appendChild(a);
    a.click();
    a.remove();
    window.URL.revokeObjectURL(url);

    statusText.textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­.";
  } catch (e) {
    console.error(e);
    statusText.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù.";
    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù.");
  } finally {
    downloadLetterBtn.disabled = false;
  }
};


    // ----------------- Ø±ÙØ¹ Ù…Ù„Ù (Ù…Ø§ Ø²Ø§Ù„ ÙŠØ³ØªØ®Ø¯Ù… backend Ù…Ù†ÙØµÙ„ Ø¹Ù„Ù‰ :5000) -----------------
    uploadBtn.onclick = () => fileInput.click();

    fileInput.onchange = async (e) => {
      const file = e.target.files[0];
      if (!file) return;
      addMessage(`ğŸ“¤ ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ${file.name}`, "user");

      const formData = new FormData();
      formData.append("file", file);

      addMessage("â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØŒ Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù†ØªØ¸Ø±...", "bot");

      try {
        const res = await fetch("http://127.0.0.1:5000/upload", {
          method: "POST",
          body: formData
        });
        const data = await res.json();

        if (data.error) {
          addMessage("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù.", "bot");
        } else {
          addMessage(data.message, "bot");
          addMessage(`ğŸ“„ Ù†Øµ Ù…Ø³ØªØ®Ø±Ø¬:\n${data.preview}`, "bot");
        }
      } catch (err) {
        console.error(err);
        addMessage("âŒ ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª.", "bot");
      }
    };

    // ----------------- Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ø¦Ù„ ÙÙŠ Ø§Ù„Ø´Ø§Øª -----------------
    function addMessage(text, sender = "bot") {
      const msg = document.createElement("div");
      msg.classList.add("message", sender);
      msg.textContent = text;
      chatBox.appendChild(msg);
      chatBox.scrollTop = chatBox.scrollHeight;
    }

  </script>
</body>
</html>
